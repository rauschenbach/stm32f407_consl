# stm32f407_consl
Сенсор газов на 8 датчиков
1) все пакеты данных которые будут пересылаться определяются в заголовках
   без первого байта (или даже слова) длины и без 2 байт контрольной суммы в конце.
   передатчик сам поместит эти данные при посылке. 
2) Переименовал проект в stm32_sens
3) Добавил файлы для псевдо eeprom
4) Буфер приема содержит только Payload - нужные данные, команда идет отдельно
5) IAR версии 6.50 стирает опции компилятора, которые сделаны в версии 7.50 - 
   А мне нужно по работе компилировать и российские процы.  
   Для компиляции stm32f429 взять более свежий IAR.например IAR-7.50 
6) поставил для проверки в Windows программу codeguard - заменил "плохую"
   функцию gmtime на gmtime32_s, которая вызывается из DLL
7) Добавил запись/чтение пачки данных из EEPROM в обе программы
8) Добавил команды "Старт"/"Стоп" измерений, пока данные читаются в никуда,
   но буду выводить в программу Windows
9) константы передаются и принимаются медленно - выскакивает exeption
   заменил на чтение до таймаута в proto.cpp
10) добавил запись регистров LMP91000 в EERPOM
11) добавил запись параметров по команде "Старт"
12) Добавил для тестирования: запись в микросхему параметров и чтение из нее.
13) тестовая программа для тестирования LMP91k
14) тестовая программа для тестирования сенсора с выходом UART
15) Добавляю опрос сенсора с выходом на UART
16) Сенсор с выводом UART работает. Опрос раз в секунду, необходимо переделать КА приема, иногда сбоит
17) Неправильно стояла системная частота. 164 вместо 168. Частота генератора (кварца) ставится в 2-х местах
   в системных файлах, поэтому дефиницией указывать HSE_VALUE=8000000!!!
18) Переделал программу для тестирования в Windows. Заменил все функции, но все равно иногда сбоит. Попробовать в Windows 7 
19) Добавил enum как описание статусов сенсоров
20) Проверить eeprom_emul на счет адресов
21) Сделал загрузчик, пока нужно обращать внимание на его работу. Как заплатку перенес перестановку
    векторов ПЕРЕД запуском scheduler. Иначе в самом начале работы происходит переключение контекста
22) Уменьшил размер приемного буфера VCP до 512.
23) Добавил DEV_ADDR в статус, куда записываю время компиляции и версию ПО
24) Добавил ф-ю get_com_time() и строку в опциях IAR "touch userfunc.c"
25) Добавил драйвер клавиатуры 2x4 в папке library
26) Сделал драйвер клавиатуры. Подцепляю меню.
27) Сделал меню по образцу от Milandr
28) Сделал русские шрифты в формате koi8. Добавил функцию перекодировки
29) Убираю пункт меню "Return", так как для этого есть кнопка
30) Сделал меню "настройка даты и времени"
31) Сделал меню "настройки каналов (a)"
32) Сделал меню "настройки НАСОСА"
33) Сделал меню "настройки громкости"
34) Сделал вывод формулы. Цифры стоят ниже букв
35) Перенес параметры канала из menu.c в sensor.c
36) Добавил запуск каналов, заменил heap2.c на heap3.c
37) Поменял выводы CD и Reset дисплея с PA2 и PA3 на PB0 и PB1 соответсвенно
38) Сделал меню "Измерения", пока не наполнял данными, так как места для 8 каналов сразу не хватает
39) Сделал "Запуск".
40) Выключеные сенсоры не отображаются
41) Добавил вывод в милливольтах
42) Необходимо сделать измерения dynament раз в секунду. Другие датчики 5 раз в секунду
43) Добавил работу с VCP - отображение на экране "Работа с VCP" и блокировка клавиатуры в этот момент
44) Добавил вывод в mV АЦП для настройки. Выводятся данные АЦП, преобразованные в милливольты
45) Поменял бит статуса "нет SD" на "VCP CONNECTED"
46) Добавил ввод коэффициентов усиление и смещение
47) Добавил "Обнуление всех каналов"
48) Добавил запись регистров lmp91k с клавиатуры. Режим "Доп. настройки"
49) Изменил опеделение printf() на log_printf()
50) Поправил перевод величин. Изменил часы: по 10 секунд выводится попеременно время и дата
51) Настроил датчик кислорода, нужно сделать калибровку с клавиатуры мин. по двум точкам
52) вытащил константы из math.c пока нет датчика давления и температуры
53) восстановил VCP функции на чужой плате. Не работает RTC- не разведено


 - Нужно сделать выключение при выходе их режима измерений или делать FET Short
 - Проверить посылаемые в I2C настройки
 - вызов функции USART_ITConfig(USART1, USART_IT_RXNE, ENABLE); вызывает проблемы при загрузки  - очистить flash контроллера!
